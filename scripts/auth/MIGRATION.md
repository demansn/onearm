# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ OAuth 2.0 Only

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—à–ª–∞ –Ω–∞ **OAuth 2.0** –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é. Personal Access Token –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚ùå –£–¥–∞–ª–µ–Ω–æ
- **Personal Access Token** (`FIGMA_TOKEN`) –≤ `.env` —Ñ–∞–π–ª–µ
- **X-Figma-Token** header –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **Fallback** —Ä–µ–∂–∏–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É OAuth –∏ Personal Token

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è** OAuth 2.0 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** OAuth credentials –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **–£–ª—É—á—à–µ–Ω–Ω—ã–µ** —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- **–î–µ—Ç–∞–ª—å–Ω–∞—è** –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª
```bash
# –£–¥–∞–ª–∏—Ç—å (–±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
# FIGMA_TOKEN=your_old_token

# –î–æ–±–∞–≤–∏—Ç—å OAuth credentials (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
FIGMA_CLIENT_ID=your_client_id_here
FIGMA_CLIENT_SECRET=your_client_secret_here
FILE_KEY=your_figma_file_key
```

### 2. –°–æ–∑–¥–∞—Ç—å OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Figma
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://www.figma.com/developers/apps
2. –ù–∞–∂–∞—Ç—å "Create new app"
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å redirect URI: `http://localhost:3000/callback`
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Client ID –∏ Client Secret

### 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
```bash
npm run setup-oauth
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- –û—Ç–∫—Ä–æ–µ—Ç –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Figma
- –°–æ—Ö—Ä–∞–Ω–∏—Ç OAuth —Ç–æ–∫–µ–Ω—ã –≤ `.figma-tokens.json`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
```bash
npm run export
```

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –î–æ (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```javascript
// –°—Ç–∞—Ä—ã–π –∫–æ–¥ –±–æ–ª—å—à–µ –ù–ï –†–ê–ë–û–¢–ê–ï–¢
const FIGMA_TOKEN = process.env.FIGMA_TOKEN;
headers: { 'X-Figma-Token': FIGMA_TOKEN }
```

### –ü–æ—Å–ª–µ (—Ç–µ–∫—É—â–∏–π –∫–æ–¥)
```javascript
// –ù–æ–≤—ã–π OAuth-only –∫–æ–¥
import { FigmaAuth } from './auth/FigmaAuth.js';

const figmaAuth = new FigmaAuth(); // –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç OAuth credentials
const response = await figmaAuth.makeAuthenticatedRequest(url);
```

## üîó –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ OAuth endpoints

- **Token Exchange**: `https://api.figma.com/v1/oauth/token`
- **Authorization URL**: `https://www.figma.com/oauth`
- **Token Refresh**: `https://api.figma.com/v1/oauth/token` (—Å `grant_type: refresh_token`)

## üõ† –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### "OAuth credentials required"
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env —Ñ–∞–π–ª:
FIGMA_CLIENT_ID=your_client_id
FIGMA_CLIENT_SECRET=your_client_secret
```

### "OAuth —Ç–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
```bash
npm run setup-oauth
```

### "Refresh token –∏—Å—Ç–µ–∫"
```bash
npm run setup-oauth  # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```

### "401 Unauthorized"
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π
# –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- `scripts/auth/FigmaAuth.js` - OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `scripts/auth/setup-oauth.js` - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- `scripts/auth/README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `.figma-tokens.json` - –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (gitignored)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **OAuth tokens** —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ `.figma-tokens.json`
- **Client Secret** –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `.env` —Ñ–∞–π–ª–µ
- **Access tokens** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 2-8 —á–∞—Å–æ–≤
- **Refresh tokens** –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –º–µ–Ω—è—Ç—å —Ç–æ–∫–µ–Ω—ã
2. **–î–ª–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏** - refresh token —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–¥–µ–ª–∏/–º–µ—Å—è—Ü—ã
3. **–õ—É—á—à–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç OAuth 2.0
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –≤—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ —Å–±–æ–µ–≤ –∏–∑-–∑–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (3 –º–∏–Ω—É—Ç—ã)

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth credentials –≤ .env
echo "FIGMA_CLIENT_ID=your_id" >> .env
echo "FIGMA_CLIENT_SECRET=your_secret" >> .env

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
npm run setup-oauth

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
npm run export
```

**–ì–æ—Ç–æ–≤–æ! –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ OAuth 2.0 –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤.**